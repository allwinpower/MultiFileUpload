!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,r,n){return r=i(r),function(t,r){if(r&&("object"===e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,o()?Reflect.construct(r,n||[],i(t).constructor):r.apply(t,n))}function r(e){var t="function"==typeof Map?new Map:void 0;return r=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(o())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var a=new(e.bind.apply(e,i));return r&&n(a,r.prototype),a}(e,arguments,i(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),n(r,e)},r(e)}function o(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(o=function(){return!!e})()}function n(e,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},n(e,t)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}var a=function(e){function r(e){var o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(o=t(this,r,[e])).originalRequest=i,o.originalResponse=a,o.causingError=n,null!=n&&(e+=", caused by ".concat(n.toString())),null!=i){var s=i.getHeader("X-Request-ID")||"n/a",l=i.getMethod(),u=i.getURL(),c=a?a.getStatus():"n/a",p=a?a.getBody()||"":"n/a";e+=", originated from request (method: ".concat(l,", url: ").concat(u,", response code: ").concat(c,", response text: ").concat(p,", request id: ").concat(s,")")}return o.message=e,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}(r,e),o=r,Object.defineProperty(o,"prototype",{writable:!1}),o;var o}(r(Error)),s=!1;function l(e){s&&console.log(e)}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,p(o.key),o)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t);if("object"!=u(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==u(t)?t:t+""}var f=function(){return c((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}),[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(e){return Promise.resolve([])}},{key:"removeUpload",value:function(e){return Promise.resolve()}},{key:"addUpload",value:function(e,t){return Promise.resolve(null)}}])}();const h="function"==typeof Buffer,d=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),y=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),m=(e=>{let t={};return e.forEach(((e,r)=>t[e]=r)),t})(y),g=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,v=String.fromCharCode.bind(String),b=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_"))),_=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),w=e=>{let t,r,o,n,i="";const a=e.length%3;for(let a=0;a<e.length;){if((r=e.charCodeAt(a++))>255||(o=e.charCodeAt(a++))>255||(n=e.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=r<<16|o<<8|n,i+=y[t>>18&63]+y[t>>12&63]+y[t>>6&63]+y[63&t]}return a?i.slice(0,a-3)+"===".substring(a):i},x="function"==typeof btoa?e=>btoa(e):h?e=>Buffer.from(e,"binary").toString("base64"):w,U=h?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,o=e.length;r<o;r+=4096)t.push(v.apply(null,e.subarray(r,r+4096)));return x(t.join(""))},S=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?v(192|t>>>6)+v(128|63&t):v(224|t>>>12&15)+v(128|t>>>6&63)+v(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return v(240|t>>>18&7)+v(128|t>>>12&63)+v(128|t>>>6&63)+v(128|63&t)},E=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,P=e=>e.replace(E,S),O=h?e=>Buffer.from(e,"utf8").toString("base64"):d?e=>U(d.encode(e)):e=>x(P(e)),C=(e,t=!1)=>t?b(O(e)):O(e),k=e=>{if(e=e.replace(/\s+/g,""),!g.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,r,o,n="";for(let i=0;i<e.length;)t=m[e.charAt(i++)]<<18|m[e.charAt(i++)]<<12|(r=m[e.charAt(i++)])<<6|(o=m[e.charAt(i++)]),n+=64===r?v(t>>16&255):64===o?v(t>>16&255,t>>8&255):v(t>>16&255,t>>8&255,255&t);return n},j=C;var L,I,R="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function T(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var A,D,z,H={};var F=function(){if(z)return D;z=1;var e=I?L:(I=1,L=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}),t=function(){if(A)return H;A=1;var e=Object.prototype.hasOwnProperty;function t(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function r(e){try{return encodeURIComponent(e)}catch(e){return null}}return H.stringify=function(t,o){o=o||"";var n,i,a=[];for(i in"string"!=typeof o&&(o="?"),t)if(e.call(t,i)){if((n=t[i])||null!=n&&!isNaN(n)||(n=""),i=r(i),n=r(n),null===i||null===n)continue;a.push(i+"="+n)}return a.length?o+a.join("&"):""},H.parse=function(e){for(var r,o=/([^=?#&]+)=?([^&]*)/g,n={};r=o.exec(e);){var i=t(r[1]),a=t(r[2]);null===i||null===a||i in n||(n[i]=a)}return n},H}(),r=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o=/[\n\r\t]/g,n=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,i=/:\d+$/,a=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,s=/^[a-zA-Z]:/;function l(e){return(e||"").toString().replace(r,"")}var u=[["#","hash"],["?","query"],function(e,t){return f(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function p(e){var t,r=("undefined"!=typeof window?window:void 0!==R?R:"undefined"!=typeof self?self:{}).location||{},o={},i=typeof(e=e||r);if("blob:"===e.protocol)o=new d(unescape(e.pathname),{});else if("string"===i)for(t in o=new d(e,{}),c)delete o[t];else if("object"===i){for(t in e)t in c||(o[t]=e[t]);void 0===o.slashes&&(o.slashes=n.test(e.href))}return o}function f(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function h(e,t){e=(e=l(e)).replace(o,""),t=t||{};var r,n=a.exec(e),i=n[1]?n[1].toLowerCase():"",s=!!n[2],u=!!n[3],c=0;return s?u?(r=n[2]+n[3]+n[4],c=n[2].length+n[3].length):(r=n[2]+n[4],c=n[2].length):u?(r=n[3]+n[4],c=n[3].length):r=n[4],"file:"===i?c>=2&&(r=r.slice(2)):f(i)?r=n[4]:i?s&&(r=r.slice(2)):c>=2&&f(t.protocol)&&(r=n[4]),{protocol:i,slashes:s||f(i),slashesCount:c,rest:r}}function d(r,n,i){if(r=(r=l(r)).replace(o,""),!(this instanceof d))return new d(r,n,i);var a,c,y,m,g,v,b=u.slice(),_=typeof n,w=this,x=0;for("object"!==_&&"string"!==_&&(i=n,n=null),i&&"function"!=typeof i&&(i=t.parse),a=!(c=h(r||"",n=p(n))).protocol&&!c.slashes,w.slashes=c.slashes||a&&n.slashes,w.protocol=c.protocol||n.protocol||"",r=c.rest,("file:"===c.protocol&&(2!==c.slashesCount||s.test(r))||!c.slashes&&(c.protocol||c.slashesCount<2||!f(w.protocol)))&&(b[3]=[/(.*)/,"pathname"]);x<b.length;x++)"function"!=typeof(m=b[x])?(y=m[0],v=m[1],y!=y?w[v]=r:"string"==typeof y?~(g="@"===y?r.lastIndexOf(y):r.indexOf(y))&&("number"==typeof m[2]?(w[v]=r.slice(0,g),r=r.slice(g+m[2])):(w[v]=r.slice(g),r=r.slice(0,g))):(g=y.exec(r))&&(w[v]=g[1],r=r.slice(0,g.index)),w[v]=w[v]||a&&m[3]&&n[v]||"",m[4]&&(w[v]=w[v].toLowerCase())):r=m(r,w);i&&(w.query=i(w.query)),a&&n.slashes&&"/"!==w.pathname.charAt(0)&&(""!==w.pathname||""!==n.pathname)&&(w.pathname=function(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),o=r.length,n=r[o-1],i=!1,a=0;o--;)"."===r[o]?r.splice(o,1):".."===r[o]?(r.splice(o,1),a++):a&&(0===o&&(i=!0),r.splice(o,1),a--);return i&&r.unshift(""),"."!==n&&".."!==n||r.push(""),r.join("/")}(w.pathname,n.pathname)),"/"!==w.pathname.charAt(0)&&f(w.protocol)&&(w.pathname="/"+w.pathname),e(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(~(g=w.auth.indexOf(":"))?(w.username=w.auth.slice(0,g),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(g+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin="file:"!==w.protocol&&f(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}return d.prototype={set:function(r,o,n){var a=this;switch(r){case"query":"string"==typeof o&&o.length&&(o=(n||t.parse)(o)),a[r]=o;break;case"port":a[r]=o,e(o,a.protocol)?o&&(a.host=a.hostname+":"+o):(a.host=a.hostname,a[r]="");break;case"hostname":a[r]=o,a.port&&(o+=":"+a.port),a.host=o;break;case"host":a[r]=o,i.test(o)?(o=o.split(":"),a.port=o.pop(),a.hostname=o.join(":")):(a.hostname=o,a.port="");break;case"protocol":a.protocol=o.toLowerCase(),a.slashes=!n;break;case"pathname":case"hash":if(o){var s="pathname"===r?"/":"#";a[r]=o.charAt(0)!==s?s+o:o}else a[r]=o;break;case"username":case"password":a[r]=encodeURIComponent(o);break;case"auth":var l=o.indexOf(":");~l?(a.username=o.slice(0,l),a.username=encodeURIComponent(decodeURIComponent(a.username)),a.password=o.slice(l+1),a.password=encodeURIComponent(decodeURIComponent(a.password))):a.username=encodeURIComponent(decodeURIComponent(o))}for(var c=0;c<u.length;c++){var p=u[c];p[4]&&(a[p[1]]=a[p[1]].toLowerCase())}return a.auth=a.password?a.username+":"+a.password:a.username,a.origin="file:"!==a.protocol&&f(a.protocol)&&a.host?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(e){e&&"function"==typeof e||(e=t.stringify);var r,o=this,n=o.host,a=o.protocol;a&&":"!==a.charAt(a.length-1)&&(a+=":");var s=a+(o.protocol&&o.slashes||f(o.protocol)?"//":"");return o.username?(s+=o.username,o.password&&(s+=":"+o.password),s+="@"):o.password?(s+=":"+o.password,s+="@"):"file:"!==o.protocol&&f(o.protocol)&&!n&&"/"!==o.pathname&&(s+="@"),(":"===n[n.length-1]||i.test(o.hostname)&&!o.port)&&(n+=":"),s+=n+o.pathname,(r="object"==typeof o.query?e(o.query):o.query)&&(s+="?"!==r.charAt(0)?"?"+r:r),o.hash&&(s+=o.hash),s}},d.extractProtocol=h,d.location=p,d.trimLeft=l,d.qs=t,D=d}(),B=T(F);function N(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */N=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,o){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new j(o||[]);return n(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var f="suspendedStart",h="suspendedYield",d="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(L([])));x&&x!==r&&o.call(x,a)&&(_=x);var U=b.prototype=g.prototype=Object.create(_);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function r(n,i,a,s){var l=p(e[n],e,i);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==M(c)&&o.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(c).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(l.arg)}var i;n(this,"_invoke",{value:function(e,o){function n(){return new t((function(t,n){r(e,o,t,n)}))}return i=i?i.then(n,n):n()}})}function P(t,r,o){var n=f;return function(i,a){if(n===d)throw Error("Generator is already running");if(n===y){if("throw"===i)throw a;return{value:e,done:!0}}for(o.method=i,o.arg=a;;){var s=o.delegate;if(s){var l=O(s,o);if(l){if(l===m)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(n===f)throw n=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);n=d;var u=p(t,r,o);if("normal"===u.type){if(n=o.done?y:h,u.arg===m)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(n=y,o.method="throw",o.arg=u.arg)}}}function O(t,r){var o=r.method,n=t.iterator[o];if(n===e)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),m;var i=p(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function L(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(M(t)+" is not iterable")}return v.prototype=b,n(U,"constructor",{value:b,configurable:!0}),n(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,l,"GeneratorFunction")),e.prototype=Object.create(U),e},t.awrap=function(e){return{__await:e}},S(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,r,o,n,i){void 0===i&&(i=Promise);var a=new E(c(e,r,o,n),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(U),u(U,l,"Generator"),u(U,a,(function(){return this})),u(U,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var o in t)r.push(o);return r.reverse(),function e(){for(;r.length;){var o=r.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=L,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(o,n){return s.type="throw",s.arg=t,r.next=o,n&&(r.method="next",r.arg=e),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var o=r.completion;if("throw"===o.type){var n=o.arg;k(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,o){return this.delegate={iterator:L(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=e),m}},t}function q(e,t,r,o,n,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(o,n)}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,n,i,a,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t);else for(;!(l=(o=i.call(r)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(e){u=!0,n=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw n}}return s}}(e,t)||G(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function G(e,t){if(e){if("string"==typeof e)return Q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(e,t):void 0}}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){X(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function X(e,t,r){return(t=J(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,J(o.key),o)}}function J(e){var t=function(e,t){if("object"!=M(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t);if("object"!=M(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==M(t)?t:t+""}var V="tus-v1",W="ietf-draft-03",ee="ietf-draft-05",te={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:ue,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:V},re=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"resume"in r&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=r,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=t,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return t=e,r=[{key:"findPreviousUploads",value:function(){var e=this;return this.options.fingerprint(this.file,this.options).then((function(t){return e._urlStorage.findUploadsByFingerprint(t)}))}},{key:"resumeFromPreviousUpload",value:function(e){this.url=e.uploadUrl||null,this._parallelUploadUrls=e.parallelUploadUrls||null,this._urlStorageKey=e.urlStorageKey}},{key:"start",value:function(){var e=this,t=this.file;if(t)if([V,W,ee].includes(this.options.protocol))if(this.options.endpoint||this.options.uploadUrl||this.url){var r=this.options.retryDelays;if(null==r||"[object Array]"===Object.prototype.toString.call(r)){if(this.options.parallelUploads>1)for(var o=0,n=["uploadUrl","uploadSize","uploadLengthDeferred"];o<n.length;o++){var i=n[o];if(this.options[i])return void this._emitError(new Error("tus: cannot use the ".concat(i," option when parallelUploads is enabled")))}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(t,this.options).then((function(r){return l(null==r?"No fingerprint was calculated meaning that the upload cannot be stored in the URL storage.":"Calculated fingerprint: ".concat(r)),e._fingerprint=r,e._source?e._source:e.options.fileReader.openFile(t,e.options.chunkSize)})).then((function(t){if(e._source=t,e.options.uploadLengthDeferred)e._size=null;else if(null!=e.options.uploadSize){if(e._size=Number(e.options.uploadSize),Number.isNaN(e._size))return void e._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(e._size=e._source.size,null==e._size)return void e._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));e.options.parallelUploads>1||null!=e._parallelUploadUrls?e._startParallelUpload():e._startSingleUpload()})).catch((function(t){e._emitError(t)}))}else this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"))}else this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));else this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));else this._emitError(new Error("tus: no file or stream to upload provided"))}},{key:"_startParallelUpload",value:function(){var t,r=this,o=this._size,n=0;this._parallelUploads=[];var i=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads,a=null!==(t=this.options.parallelUploadBoundaries)&&void 0!==t?t:function(e,t){for(var r=Math.floor(e/t),o=[],n=0;n<t;n++)o.push({start:r*n,end:r*(n+1)});return o[t-1].end=e,o}(this._source.size,i);this._parallelUploadUrls&&a.forEach((function(e,t){e.uploadUrl=r._parallelUploadUrls[t]||null})),this._parallelUploadUrls=new Array(a.length);var s,u=a.map((function(t,i){var s=0;return r._source.slice(t.start,t.end).then((function(l){var u=l.value;return new Promise((function(l,c){var p=K(K({},r.options),{},{uploadUrl:t.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:r.options.metadataForPartialUploads,headers:K(K({},r.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:l,onError:c,onProgress:function(e){n=n-s+e,s=e,r._emitProgress(n,o)},onUploadUrlAvailable:function(){r._parallelUploadUrls[i]=f.url,r._parallelUploadUrls.filter((function(e){return Boolean(e)})).length===a.length&&r._saveUploadInUrlStorage()}}),f=new e(u,p);f.start(),r._parallelUploads.push(f)}))}))}));Promise.all(u).then((function(){(s=r._openRequest("POST",r.options.endpoint)).setHeader("Upload-Concat","final;".concat(r._parallelUploadUrls.join(" ")));var e=oe(r.options.metadata);return""!==e&&s.setHeader("Upload-Metadata",e),r._sendRequest(s,null)})).then((function(e){if(ne(e.getStatus(),200)){var t=e.getHeader("Location");null!=t?(r.url=ce(r.options.endpoint,t),l("Created upload at ".concat(r.url)),r._emitSuccess(e)):r._emitHttpError(s,e,"tus: invalid or missing Location header")}else r._emitHttpError(s,e,"tus: unexpected response while creating upload")})).catch((function(e){r._emitError(e)}))}},{key:"_startSingleUpload",value:function(){return this._aborted=!1,null!=this.url?(l("Resuming upload from previous URL: ".concat(this.url)),void this._resumeUpload()):null!=this.options.uploadUrl?(l("Resuming upload from provided URL: ".concat(this.options.uploadUrl)),this.url=this.options.uploadUrl,void this._resumeUpload()):(l("Creating a new upload"),void this._createUpload())}},{key:"abort",value:function(t){var r=this;if(null!=this._parallelUploads){var o,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=G(e))||t){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}(this._parallelUploads);try{for(n.s();!(o=n.n()).done;)o.value.abort(t)}catch(e){n.e(e)}finally{n.f()}}return null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),t&&null!=this.url?e.terminate(this.url,this.options).then((function(){return r._removeFromUrlStorage()})):Promise.resolve()}},{key:"_emitHttpError",value:function(e,t,r,o){this._emitError(new a(r,o,e,t))}},{key:"_emitError",value:function(e){var t=this;if(!this._aborted){if(null!=this.options.retryDelays&&(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),le(e,this._retryAttempt,this.options))){var r=this.options.retryDelays[this._retryAttempt++];return this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout((function(){t.start()}),r))}if("function"!=typeof this.options.onError)throw e;this.options.onError(e)}}},{key:"_emitSuccess",value:function(e){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess({lastResponse:e})}},{key:"_emitProgress",value:function(e,t){"function"==typeof this.options.onProgress&&this.options.onProgress(e,t)}},{key:"_emitChunkComplete",value:function(e,t,r){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(e,t,r)}},{key:"_createUpload",value:function(){var e=this;if(this.options.endpoint){var t=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?t.setHeader("Upload-Defer-Length","1"):t.setHeader("Upload-Length","".concat(this._size));var r,o=oe(this.options.metadata);""!==o&&t.setHeader("Upload-Metadata",o),this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,r=this._addChunkToRequest(t)):(this.options.protocol!==W&&this.options.protocol!==ee||t.setHeader("Upload-Complete","?0"),r=this._sendRequest(t,null)),r.then((function(r){if(ne(r.getStatus(),200)){var o=r.getHeader("Location");if(null!=o){if(e.url=ce(e.options.endpoint,o),l("Created upload at ".concat(e.url)),"function"==typeof e.options.onUploadUrlAvailable&&e.options.onUploadUrlAvailable(),0===e._size)return e._emitSuccess(r),void e._source.close();e._saveUploadInUrlStorage().then((function(){e.options.uploadDataDuringCreation?e._handleUploadResponse(t,r):(e._offset=0,e._performUpload())}))}else e._emitHttpError(t,r,"tus: invalid or missing Location header")}else e._emitHttpError(t,r,"tus: unexpected response while creating upload")})).catch((function(r){e._emitHttpError(t,null,"tus: failed to create upload",r)}))}else this._emitError(new Error("tus: unable to create upload because no endpoint is provided"))}},{key:"_resumeUpload",value:function(){var e=this,t=this._openRequest("HEAD",this.url);this._sendRequest(t,null).then((function(r){var o=r.getStatus();if(!ne(o,200))return 423===o?void e._emitHttpError(t,r,"tus: upload is currently locked; retry later"):(ne(o,400)&&e._removeFromUrlStorage(),e.options.endpoint?(e.url=null,void e._createUpload()):void e._emitHttpError(t,r,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));var n=Number.parseInt(r.getHeader("Upload-Offset"),10);if(Number.isNaN(n))e._emitHttpError(t,r,"tus: invalid or missing offset value");else{var i=Number.parseInt(r.getHeader("Upload-Length"),10);!Number.isNaN(i)||e.options.uploadLengthDeferred||e.options.protocol!==V?("function"==typeof e.options.onUploadUrlAvailable&&e.options.onUploadUrlAvailable(),e._saveUploadInUrlStorage().then((function(){if(n===i)return e._emitProgress(i,i),void e._emitSuccess(r);e._offset=n,e._performUpload()}))):e._emitHttpError(t,r,"tus: invalid or missing length value")}})).catch((function(r){e._emitHttpError(t,null,"tus: failed to resume upload",r)}))}},{key:"_performUpload",value:function(){var e,t=this;this._aborted||(this.options.overridePatchMethod?(e=this._openRequest("POST",this.url)).setHeader("X-HTTP-Method-Override","PATCH"):e=this._openRequest("PATCH",this.url),e.setHeader("Upload-Offset","".concat(this._offset)),this._addChunkToRequest(e).then((function(r){ne(r.getStatus(),200)?t._handleUploadResponse(e,r):t._emitHttpError(e,r,"tus: unexpected response while uploading chunk")})).catch((function(r){t._aborted||t._emitHttpError(e,null,"tus: failed to upload chunk at offset ".concat(t._offset),r)})))}},{key:"_addChunkToRequest",value:function(e){var t=this,r=this._offset,o=this._offset+this.options.chunkSize;return e.setProgressHandler((function(e){t._emitProgress(r+e,t._size)})),this.options.protocol===V?e.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===ee&&e.setHeader("Content-Type","application/partial-upload"),(o===Number.POSITIVE_INFINITY||o>this._size)&&!this.options.uploadLengthDeferred&&(o=this._size),this._source.slice(r,o).then((function(r){var o=r.value,n=r.done,i=null!=o&&o.size?o.size:0;t.options.uploadLengthDeferred&&n&&(t._size=t._offset+i,e.setHeader("Upload-Length","".concat(t._size)));var a=t._offset+i;return!t.options.uploadLengthDeferred&&n&&a!==t._size?Promise.reject(new Error("upload was configured with a size of ".concat(t._size," bytes, but the source is done after ").concat(a," bytes"))):null===o?t._sendRequest(e):(t.options.protocol!==W&&t.options.protocol!==ee||e.setHeader("Upload-Complete",n?"?1":"?0"),t._emitProgress(t._offset,t._size),t._sendRequest(e,o))}))}},{key:"_handleUploadResponse",value:function(e,t){var r=Number.parseInt(t.getHeader("Upload-Offset"),10);if(Number.isNaN(r))this._emitHttpError(e,t,"tus: invalid or missing offset value");else{if(this._emitProgress(r,this._size),this._emitChunkComplete(r-this._offset,r,this._size),this._offset=r,r===this._size)return this._emitSuccess(t),void this._source.close();this._performUpload()}}},{key:"_openRequest",value:function(e,t){var r=ie(e,t,this.options);return this._req=r,r}},{key:"_removeFromUrlStorage",value:function(){var e=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch((function(t){e._emitError(t)})),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var e=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||null!==this._urlStorageKey)return Promise.resolve();var t={size:this._size,metadata:this.options.metadata,creationTime:(new Date).toString()};return this._parallelUploads?t.parallelUploadUrls=this._parallelUploadUrls:t.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,t).then((function(t){e._urlStorageKey=t}))}},{key:"_sendRequest",value:function(e){return ae(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,this.options)}}],o=[{key:"terminate",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=ie("DELETE",t,r);return ae(o,null,r).then((function(e){if(204!==e.getStatus())throw new a("tus: unexpected response while terminating upload",null,o,e)})).catch((function(n){if(n instanceof a||(n=new a("tus: failed to terminate upload",n,o,null)),!le(n,0,r))throw n;var i=r.retryDelays[0],s=r.retryDelays.slice(1),l=K(K({},r),{},{retryDelays:s});return new Promise((function(e){return setTimeout(e,i)})).then((function(){return e.terminate(t,l)}))}))}}],r&&Y(t.prototype,r),o&&Y(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,o}();function oe(e){return Object.entries(e).map((function(e){var t=$(e,2),r=t[0],o=t[1];return"".concat(r," ").concat(j(String(o)))})).join(",")}function ne(e,t){return e>=t&&e<t+100}function ie(e,t,r){var o=r.httpStack.createRequest(e,t);r.protocol===W?o.setHeader("Upload-Draft-Interop-Version","5"):r.protocol===ee?o.setHeader("Upload-Draft-Interop-Version","6"):o.setHeader("Tus-Resumable","1.0.0");for(var n=r.headers||{},i=0,a=Object.entries(n);i<a.length;i++){var s=$(a[i],2),l=s[0],u=s[1];o.setHeader(l,u)}if(r.addRequestId){var c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));o.setHeader("X-Request-ID",c)}return o}function ae(e,t,r){return se.apply(this,arguments)}function se(){var e;return e=N().mark((function e(t,r,o){var n;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof o.onBeforeRequest){e.next=3;break}return e.next=3,o.onBeforeRequest(t);case 3:return e.next=5,t.send(r);case 5:if(n=e.sent,"function"!=typeof o.onAfterResponse){e.next=9;break}return e.next=9,o.onAfterResponse(t,n);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})),se=function(){var t=this,r=arguments;return new Promise((function(o,n){var i=e.apply(t,r);function a(e){q(i,o,n,a,s,"next",e)}function s(e){q(i,o,n,a,s,"throw",e)}a(void 0)}))},se.apply(this,arguments)}function le(e,t,r){return!(null==r.retryDelays||t>=r.retryDelays.length||null==e.originalRequest)&&(r&&"function"==typeof r.onShouldRetry?r.onShouldRetry(e,t,r):ue(e))}function ue(e){var t,r=e.originalResponse?e.originalResponse.getStatus():0;return(!ne(r,400)||409===r||423===r)&&(t=!0,"undefined"!=typeof navigator&&!1===navigator.onLine&&(t=!1),t)}function ce(e,t){return new B(t,e).toString()}re.defaultOptions=te;var pe=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase()};function fe(e){return new Promise((function(t,r){var o=new XMLHttpRequest;o.responseType="blob",o.onload=function(){var e=o.response;t(e)},o.onerror=function(e){r(e)},o.open("GET",e),o.send()}))}function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function de(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ye(o.key),o)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ye(e){var t=function(e,t){if("object"!=he(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t);if("object"!=he(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==he(t)?t:t+""}var me=function(){return de((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._file=t,this.size=t.size}),[{key:"slice",value:function(e,t){if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova))return r=this._file.slice(e,t),new Promise((function(e,t){var o=new FileReader;o.onload=function(){var t=new Uint8Array(o.result);e({value:t})},o.onerror=function(e){t(e)},o.readAsArrayBuffer(r)}));var r,o=this._file.slice(e,t),n=t>=this.size;return Promise.resolve({value:o,done:n})}},{key:"close",value:function(){}}])}();function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function ve(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,be(o.key),o)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function be(e){var t=function(e,t){if("object"!=ge(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t);if("object"!=ge(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==ge(t)?t:t+""}function _e(e){return void 0===e?0:void 0!==e.size?e.size:e.length}var we=function(){return ve((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._buffer=void 0,this._bufferOffset=0,this._reader=t,this._done=!1}),[{key:"slice",value:function(e,t){return e<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(e,t)}},{key:"_readUntilEnoughDataOrDone",value:function(e,t){var r=this,o=t<=this._bufferOffset+_e(this._buffer);if(this._done||o){var n=this._getDataFromBuffer(e,t),i=null==n&&this._done;return Promise.resolve({value:n,done:i})}return this._reader.read().then((function(o){var n=o.value;return o.done?r._done=!0:void 0===r._buffer?r._buffer=n:r._buffer=function(e,t){if(e.concat)return e.concat(t);if(e instanceof Blob)return new Blob([e,t],{type:e.type});if(e.set){var r=new e.constructor(e.length+t.length);return r.set(e),r.set(t,e.length),r}throw new Error("Unknown data type")}(r._buffer,n),r._readUntilEnoughDataOrDone(e,t)}))}},{key:"_getDataFromBuffer",value:function(e,t){e>this._bufferOffset&&(this._buffer=this._buffer.slice(e-this._bufferOffset),this._bufferOffset=e);var r=0===_e(this._buffer);return this._done&&r?null:this._buffer.slice(0,t-e)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Ue(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ue=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,o){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new j(o||[]);return n(a,"_invoke",{value:P(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var f="suspendedStart",h="suspendedYield",d="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(L([])));x&&x!==r&&o.call(x,a)&&(_=x);var U=b.prototype=g.prototype=Object.create(_);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function r(n,i,a,s){var l=p(e[n],e,i);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==xe(c)&&o.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(c).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(l.arg)}var i;n(this,"_invoke",{value:function(e,o){function n(){return new t((function(t,n){r(e,o,t,n)}))}return i=i?i.then(n,n):n()}})}function P(t,r,o){var n=f;return function(i,a){if(n===d)throw Error("Generator is already running");if(n===y){if("throw"===i)throw a;return{value:e,done:!0}}for(o.method=i,o.arg=a;;){var s=o.delegate;if(s){var l=O(s,o);if(l){if(l===m)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(n===f)throw n=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);n=d;var u=p(t,r,o);if("normal"===u.type){if(n=o.done?y:h,u.arg===m)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(n=y,o.method="throw",o.arg=u.arg)}}}function O(t,r){var o=r.method,n=t.iterator[o];if(n===e)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),m;var i=p(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function L(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(xe(t)+" is not iterable")}return v.prototype=b,n(U,"constructor",{value:b,configurable:!0}),n(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,l,"GeneratorFunction")),e.prototype=Object.create(U),e},t.awrap=function(e){return{__await:e}},S(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,r,o,n,i){void 0===i&&(i=Promise);var a=new E(c(e,r,o,n),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(U),u(U,l,"Generator"),u(U,a,(function(){return this})),u(U,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var o in t)r.push(o);return r.reverse(),function e(){for(;r.length;){var o=r.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=L,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(o,n){return s.type="throw",s.arg=t,r.next=o,n&&(r.method="next",r.arg=e),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var o=r.completion;if("throw"===o.type){var n=o.arg;k(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,o){return this.delegate={iterator:L(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=e),m}},t}function Se(e,t,r,o,n,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(o,n)}function Ee(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Pe(o.key),o)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pe(e){var t=function(e,t){if("object"!=xe(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t);if("object"!=xe(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==xe(t)?t:t+""}var Oe=function(){return Ee((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}),[{key:"openFile",value:(e=Ue().mark((function e(t,r){var o;return Ue().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!pe()||!t||void 0===t.uri){e.next=11;break}return e.prev=1,e.next=4,fe(t.uri);case 4:return o=e.sent,e.abrupt("return",new me(o));case 8:throw e.prev=8,e.t0=e.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(e.t0));case 11:if("function"!=typeof t.slice||void 0===t.size){e.next=13;break}return e.abrupt("return",Promise.resolve(new me(t)));case 13:if("function"!=typeof t.read){e.next=18;break}if(r=Number(r),Number.isFinite(r)){e.next=17;break}return e.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return e.abrupt("return",Promise.resolve(new we(t,r)));case 18:return e.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return e.stop()}}),e,null,[[1,8]])})),t=function(){var t=this,r=arguments;return new Promise((function(o,n){var i=e.apply(t,r);function a(e){Se(i,o,n,a,s,"next",e)}function s(e){Se(i,o,n,a,s,"throw",e)}a(void 0)}))},function(e,r){return t.apply(this,arguments)})}]);var e,t}();function Ce(e){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ce(e)}function ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function je(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Le(o.key),o)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Le(e){var t=function(e,t){if("object"!=Ce(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t);if("object"!=Ce(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==Ce(t)?t:t+""}var Ie=function(){return je((function e(){ke(this,e)}),[{key:"createRequest",value:function(e,t){return new Re(e,t)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),Re=function(){return je((function e(t,r){ke(this,e),this._xhr=new XMLHttpRequest,this._xhr.open(t,r,!0),this._method=t,this._url=r,this._headers={}}),[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(e,t){this._xhr.setRequestHeader(e,t),this._headers[e]=t}},{key:"getHeader",value:function(e){return this._headers[e]}},{key:"setProgressHandler",value:function(e){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(t){t.lengthComputable&&e(t.loaded)})}},{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise((function(r,o){e._xhr.onload=function(){r(new Te(e._xhr))},e._xhr.onerror=function(e){o(e)},e._xhr.send(t)}))}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Te=function(){return je((function e(t){ke(this,e),this._xhr=t}),[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(e){return this._xhr.getResponseHeader(e)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function De(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ze(o.key),o)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ze(e){var t=function(e,t){if("object"!=Ae(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t);if("object"!=Ae(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==Ae(t)?t:t+""}var He=!1;try{He="localStorage"in window;var Fe="tusSupport",Be=localStorage.getItem(Fe);localStorage.setItem(Fe,Be),null===Be&&localStorage.removeItem(Fe)}catch(e){if(e.code!==e.SECURITY_ERR&&e.code!==e.QUOTA_EXCEEDED_ERR)throw e;He=!1}var Ne=He,qe=function(){return De((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}),[{key:"findAllUploads",value:function(){var e=this._findEntries("tus::");return Promise.resolve(e)}},{key:"findUploadsByFingerprint",value:function(e){var t=this._findEntries("tus::".concat(e,"::"));return Promise.resolve(t)}},{key:"removeUpload",value:function(e){return localStorage.removeItem(e),Promise.resolve()}},{key:"addUpload",value:function(e,t){var r=Math.round(1e12*Math.random()),o="tus::".concat(e,"::").concat(r);return localStorage.setItem(o,JSON.stringify(t)),Promise.resolve(o)}},{key:"_findEntries",value:function(e){for(var t=[],r=0;r<localStorage.length;r++){var o=localStorage.key(r);if(0===o.indexOf(e))try{var n=JSON.parse(localStorage.getItem(o));n.urlStorageKey=o,t.push(n)}catch(e){}}return t}}])}();function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}function Me(e,t,r){return r&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ve(o.key),o)}}(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ge(e,t,r){return t=Ze(t),function(e,t){if(t&&("object"===$e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Qe()?Reflect.construct(t,r||[],Ze(e).constructor):t.apply(e,r))}function Qe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Qe=function(){return!!e})()}function Ze(e){return Ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ze(e)}function Ke(e,t){return Ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ke(e,t)}function Xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(r),!0).forEach((function(t){Je(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Je(e,t,r){return(t=Ve(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ve(e){var t=function(e,t){if("object"!=$e(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t);if("object"!=$e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==$e(t)?t:t+""}var We=Ye(Ye({},re.defaultOptions),{},{httpStack:new Ie,fileReader:new Oe,urlStorage:Ne?new qe:new f,fingerprint:function(e,t){return pe()?Promise.resolve(function(e,t){var r=e.exif?function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t}(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",r,t.endpoint].join("/")}(e,t)):Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,t.endpoint].join("-"))}}),et=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ge(this,t,[e,r=Ye(Ye({},We),r)])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ke(e,t)}(t,e),Me(t,0,[{key:"terminate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=Ye(Ye({},We),t),re.terminate(e,t)}}])}(re),tt="function"==typeof XMLHttpRequest&&"function"==typeof Blob&&"function"==typeof Blob.prototype.slice,rt=Object.freeze({__proto__:null,DefaultHttpStack:Ie,DetailedError:a,Upload:et,canStoreURLs:Ne,defaultOptions:We,enableDebugLog:function(){s=!0},isSupported:tt});const ot=document.createElement("template");ot.innerHTML='\n       <style>:host{box-sizing:border-box;flex-direction:row;gap:10px;min-height:250px;display:flex}:host([progress-position=bottom]){flex-direction:column}:host([progress-position=bottom]) #upload-container{flex-basis:auto}:host([progress-position=bottom]) #progress-area{flex-shrink:1;flex-basis:auto;width:100%;max-height:350px}:host([progress-position=left]){flex-direction:row-reverse}#upload-container{flex-direction:column;flex:1;min-width:0;display:flex}#drop-zone{text-align:center;cursor:pointer;box-sizing:border-box;background-color:#fff;border:2px dashed #ced4da;border-radius:8px;flex-direction:column;flex-grow:1;justify-content:center;align-items:center;min-height:160px;padding:25px;transition:border-color .2s ease-in-out,background-color .2s ease-in-out;display:flex;box-shadow:0 1px 2px #0000000d}#drop-zone.drag-over{background-color:#f0f8ff;border-color:#0d6efd}#drop-zone p{color:#6c757d;margin:5px 0;font-size:.95em}#browse-btn{color:#fff;cursor:pointer;background-color:#0d6efd;border:none;border-radius:5px;margin-top:10px;padding:8px 18px;font-size:.9em;transition:background-color .2s}#browse-btn:hover{background-color:#0b5ed7}#drop-zone:before{content:"📤";color:#ced4da;margin-bottom:10px;font-size:2.5em;transition:color .2s ease-in-out}#drop-zone.drag-over:before{color:#0d6efd}#progress-area{box-sizing:border-box;background-color:#fff;border:1px solid #dee2e6;border-radius:8px;flex-direction:column;flex-shrink:0;flex-basis:380px;max-height:500px;padding:20px;display:flex;overflow-y:auto;box-shadow:0 1px 3px #00000012}#progress-area h2{text-align:center;color:#495057;border-bottom:1px solid #e9ecef;flex-shrink:0;margin-top:0;margin-bottom:15px;padding-bottom:10px;font-size:1.15em}.progress-message{word-wrap:break-word;overflow-wrap:break-word;border:1px solid #0000;border-radius:4px;flex-shrink:0;margin-bottom:8px;padding:8px 12px;font-size:.88em;line-height:1.4;transition:background-color .3s,border-color .3s;position:relative}.progress-message:last-child{margin-bottom:0}.status-waiting{color:#6c757d;background-color:#f8f9fa;border-color:#e9ecef}.status-uploading{color:#052c65;background-color:#e7f3ff;border-color:#cfe2ff}.status-success{color:#0f5132;background-color:#d1e7dd;border-color:#badbcc}.status-error{color:#58151c;background-color:#f8d7da;border-color:#f5c2c7}.error-details{color:#842029;word-wrap:break-word;overflow-wrap:break-word;margin-top:4px;font-size:.9em;display:block}#initial-placeholder{text-align:center;color:#6c757d;flex-grow:1;justify-content:center;align-items:center;margin:auto;padding:20px;font-style:italic;display:flex}</style>\n\n       <div id="upload-container">\n           <input type="file" id="file-input" multiple hidden>\n           <div id="drop-zone">\n               <p>Drag & Drop files here</p>\n               <p style="font-size: 0.8em; margin-top: 0;">or</p>\n               <button type="button" id="browse-btn">Browse Files</button>\n           </div>\n       </div>\n\n       <div id="progress-area">\n           <h2>Upload Status</h2>\n           </div>\n     ';class nt extends HTMLElement{static get observedAttributes(){return["endpoint","max-concurrent-uploads","retry-delays","group-id","progress-position"]}constructor(){super(),this.uploadQueue=[],this.activeUploadCount=0,this.activeUploads={},this._tusEndpoint="/files/",this._maxConcurrentUploads=3,this._retryDelays=[0,3e3,5e3,1e4],this._currentGroupId=null,this.successfulUploads=[],this._boundHandleBrowseClick=this._handleBrowseClick.bind(this),this._boundHandleFileChange=this._handleFileChange.bind(this),this._boundPreventDefaults=this._preventDefaults.bind(this),this._boundHighlight=this._highlight.bind(this),this._boundUnhighlight=this._unhighlight.bind(this),this._boundHandleDrop=this._handleDrop.bind(this),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(ot.content.cloneNode(!0)),this._dropZone=this.shadowRoot.getElementById("drop-zone"),this._fileInput=this.shadowRoot.getElementById("file-input"),this._browseBtn=this.shadowRoot.getElementById("browse-btn"),this._progressArea=this.shadowRoot.getElementById("progress-area"),console.log("[Component] Initialized.")}connectedCallback(){console.log("[Component] Added to the page."),this._updateConfigFromAttributes(),this._addEventListeners(),this._addInitialPlaceholder()}disconnectedCallback(){console.log("[Component] Removed from the page."),this._removeEventListeners(),Object.values(this.activeUploads).forEach((e=>{try{e?.abort(),console.log(`[Component] Aborted upload for ${e?.file?.name} on disconnect.`)}catch(e){console.warn("[Component] Could not abort upload",e)}})),this.activeUploads={},this.uploadQueue=[],this.activeUploadCount=0}attributeChangedCallback(e,t,r){console.log(`[Component] Attribute ${e} changed from ${t} to ${r}`),t!==r&&this._updateConfigFromAttributes()}isUploading(){return this.activeUploadCount>0}uploadFiles(e,t){e&&0!==e.length?null!=t&&""!==String(t).trim()?(console.log(`[Component] Upload requested via uploadFiles method for Group ID: ${t}`),this._initiateBatchUpload(e,t)):console.error("[Component] uploadFiles requires a non-empty groupId."):console.warn("[Component] uploadFiles called with no files.")}getFiles(){return this.successfulUploads.map((e=>({fileName:e.fileName,fileSize:e.fileSize,fileType:e.fileType})))}clearSuccessfulUploads(){this.successfulUploads=[],console.log("[Component] List of successful uploads cleared.")}_updateConfigFromAttributes(){if(this.hasAttribute("endpoint")?this._tusEndpoint=this.getAttribute("endpoint"):this._tusEndpoint="/files/",this.hasAttribute("max-concurrent-uploads")){const e=parseInt(this.getAttribute("max-concurrent-uploads"),10);!isNaN(e)&&e>0&&(this._maxConcurrentUploads=e)}else this._maxConcurrentUploads=3;if(this.hasAttribute("retry-delays"))try{const e=JSON.parse(this.getAttribute("retry-delays"));Array.isArray(e)&&e.every((e=>"number"==typeof e))?this._retryDelays=e:(console.warn("[Component] Invalid retry-delays attribute format. Expected JSON array of numbers."),this._retryDelays=[0,3e3,5e3,1e4])}catch(e){console.warn("[Component] Could not parse retry-delays attribute.",e),this._retryDelays=[0,3e3,5e3,1e4]}else this._retryDelays=[0,3e3,5e3,1e4];if(this.hasAttribute("group-id")){const e=this.getAttribute("group-id");e&&""!==e.trim()?this._currentGroupId=e.trim():(console.warn("[Component] 'group-id' attribute is present but empty. It will be ignored for browse/drop actions."),this._currentGroupId=null)}else this._currentGroupId=null;console.log(`[Component] Config updated: Endpoint=${this._tusEndpoint}, MaxConcurrent=${this._maxConcurrentUploads}, Retries=${JSON.stringify(this._retryDelays)}, CurrentGroupID=${this._currentGroupId}`)}_addEventListeners(){this._browseBtn.addEventListener("click",this._boundHandleBrowseClick),this._fileInput.addEventListener("change",this._boundHandleFileChange),["dragenter","dragover","dragleave","drop"].forEach((e=>{this._dropZone.addEventListener(e,this._boundPreventDefaults,!1)})),["dragenter","dragover"].forEach((e=>{this._dropZone.addEventListener(e,this._boundHighlight,!1)})),["dragleave","drop"].forEach((e=>{this._dropZone.addEventListener(e,this._boundUnhighlight,!1)})),this._dropZone.addEventListener("drop",this._boundHandleDrop,!1)}_removeEventListeners(){this._browseBtn.removeEventListener("click",this._boundHandleBrowseClick),this._fileInput.removeEventListener("change",this._boundHandleFileChange),["dragenter","dragover","dragleave","drop"].forEach((e=>{this._dropZone.removeEventListener(e,this._boundPreventDefaults,!1)})),["dragenter","dragover"].forEach((e=>{this._dropZone.removeEventListener(e,this._boundHighlight,!1)})),["dragleave","drop"].forEach((e=>{this._dropZone.removeEventListener(e,this._boundUnhighlight,!1)})),this._dropZone.removeEventListener("drop",this._boundHandleDrop,!1)}_handleBrowseClick(){if(!this._currentGroupId)return console.error("[Component] Cannot browse for files: The 'group-id' attribute is not set or is empty on the <multi-file-upload> element."),void alert("Error: Please ensure the upload component has a valid 'group-id' attribute set.");this._fileInput.click()}_handleFileChange(e){if(!this._currentGroupId)return console.error("[Component] Cannot process files from browse: The 'group-id' attribute is not set or is empty."),void(e.target.value=null);console.log(`[Component] Files selected via browse. Using attribute Group ID: ${this._currentGroupId}`),this._initiateBatchUpload(e.target.files,this._currentGroupId),e.target.value=null}_preventDefaults(e){e.preventDefault(),e.stopPropagation()}_highlight(){this._dropZone.classList.add("drag-over")}_unhighlight(){this._dropZone.classList.remove("drag-over")}_handleDrop(e){if(!this._currentGroupId)return console.error("[Component] Cannot process dropped files: The 'group-id' attribute is not set or is empty on the <multi-file-upload> element."),void this._updateProgressMessage(`drop-error-${Date.now()}`,"Drop Failed: Missing 'group-id'","status-error","The 'group-id' attribute must be set on the upload component.");console.log(`[Component] Files dropped. Using attribute Group ID: ${this._currentGroupId}`),this._initiateBatchUpload(e.dataTransfer.files,this._currentGroupId)}_initiateBatchUpload(e,t){e&&0!==e.length&&(null!=t&&""!==String(t).trim()?(console.log(`[Component] Adding ${e.length} file(s) to queue for Group ID: ${t}`),Array.from(e).forEach((e=>{const r=`file-${t}-${e.name.replace(/[^a-zA-Z0-9.-]/g,"-")}-${e.size}-${e.lastModified}-${Math.random().toString(36).substring(2,7)}`,o={file:e,groupId:t,fileId:r};this.shadowRoot.getElementById(r)||this.uploadQueue.some((e=>e.fileId===r))||this.activeUploads[r]?console.warn(`[Component] File ${e.name} (ID: ${r}) seems to be already queued or uploading. Skipping.`):(this._addProgressMessage(r,`Waiting: ${this._escapeHTML(e.name)} (${this._formatFileSize(e.size)})`),this.uploadQueue.push(o))})),this._processQueue()):console.error("[Component] _initiateBatchUpload called without a valid groupId. Aborting batch."))}_processQueue(){for(console.log(`[Queue] Processing... Active: ${this.activeUploadCount}, Queue Length: ${this.uploadQueue.length}`);this.activeUploadCount<this._maxConcurrentUploads&&this.uploadQueue.length>0;){this.activeUploadCount++;const e=this.uploadQueue.shift();console.log(`[Queue] Starting upload for ${e.file.name} (ID: ${e.fileId}, Group: ${e.groupId}). Active count: ${this.activeUploadCount}`),this._startTusUpload(e)}0===this.uploadQueue.length&&0===this.activeUploadCount&&(console.log("[Queue] Queue empty and no active uploads."),this._addInitialPlaceholder())}_startTusUpload(e){if(void 0===rt||"function"!=typeof et)return console.error("[Component] tus-js-client library not loaded or tus.Upload is not a function."),this._updateProgressMessage(e.fileId,`Error: ${this._escapeHTML(e.file.name)} - tus library issue`,"status-error"),void this._uploadFinished(e.fileId,e.groupId,!1);const{file:t,groupId:r,fileId:o}=e;this._updateProgressMessage(o,`Initiating: ${this._escapeHTML(t.name)}`,"status-uploading");let n=null;const i={endpoint:this._tusEndpoint,retryDelays:this._retryDelays,metadata:{filename:t.name,filetype:t.type||"application/octet-stream",groupId:String(r)},id:o,onError:e=>{console.error(`[tus Error - ${o}] ${t.name}:`,e);let n=String(e);if(e.originalRequest){n=`Network Error (${e.originalRequest.getStatus()}`;const t=e.originalRequest.getResponseText();t&&(n+=`: ${t.substring(0,100)}${t.length>100?"...":""}`),n+=")"}else e.cause&&(n=String(e.cause));this._updateProgressMessage(o,`Error: ${this._escapeHTML(t.name)}`,"status-error",this._escapeHTML(n)),this._uploadFinished(o,r,!1)},onProgress:(e,r)=>{const n=r>0?(e/r*100).toFixed(0):0;this._updateProgressMessage(o,`Uploading (${n}%): ${this._escapeHTML(t.name)}`,"status-uploading")},onSuccess:()=>{console.log(`[tus Success - ${o}] Finished ${t.name} (Group: ${r})`),this._updateProgressMessage(o,`Success: ${this._escapeHTML(t.name)}`,"status-success");const i=n?n.url:null,a={fileId:o,fileName:e.file.name,fileSize:e.file.size,fileType:e.file.type||"application/octet-stream",groupId:e.groupId,uploadUrl:i,timestamp:new Date};this.successfulUploads.push(a),this._uploadFinished(o,r,!0),this.dispatchEvent(new CustomEvent("upload-success",{bubbles:!0,composed:!0,detail:{...a}}))}};try{n=new et(t,i),this.activeUploads[o]=n,n.start()}catch(e){console.error(`[Component] Failed to initialize tus.Upload for ${t.name}:`,e),this._updateProgressMessage(o,`Error: ${this._escapeHTML(t.name)} - Init failed`,"status-error",String(e)),this._uploadFinished(o,r,!1)}}_uploadFinished(e,t,r){this.activeUploads[e]?(this.activeUploadCount--,delete this.activeUploads[e],console.log(`[Queue] Upload ${r?"finished successfully":"failed/aborted"} (ID: ${e}, Group: ${t}). Active count: ${this.activeUploadCount}`),0===this.activeUploadCount&&0===this.uploadQueue.length&&(console.log("[Component] All known uploads finished and queue is empty."),this.dispatchEvent(new CustomEvent("all-uploads-complete",{bubbles:!0,composed:!0})),this._addInitialPlaceholder()),this._processQueue()):(console.warn(`[Component] _uploadFinished called for unknown or already finished fileId: ${e}`),this.activeUploadCount<0&&(this.activeUploadCount=0),0===this.activeUploadCount&&0===this.uploadQueue.length&&(this.dispatchEvent(new CustomEvent("all-uploads-complete",{bubbles:!0,composed:!0})),this._addInitialPlaceholder()))}_addProgressMessage(e,t){this._removeInitialPlaceholder();const r=document.createElement("div");r.id=e,r.className="progress-message status-waiting",r.textContent=t,this._progressArea.appendChild(r),this._progressArea.scrollTop=this._progressArea.scrollHeight}_updateProgressMessage(e,t,r="",o=null){const n=this.shadowRoot.getElementById(e);if(n){let e=n.querySelector(".error-details");e&&e.remove(),n.textContent=t,n.className=`progress-message ${r}`,o&&(e=document.createElement("span"),e.className="error-details",e.textContent=o,n.appendChild(e)),this._progressArea.scrollHeight>this._progressArea.clientHeight&&(this._progressArea.scrollTop=this._progressArea.scrollHeight)}else e.startsWith("drop-error-")||console.warn(`[Component] Could not find message element for ID: ${e}`)}_addInitialPlaceholder(){const e=this._progressArea.querySelector(".progress-message"),t=this.shadowRoot.getElementById("initial-placeholder");if(!e&&!t){console.log("[UI] Adding initial placeholder");const e=document.createElement("p");e.id="initial-placeholder",e.textContent="Drag files or click browse to start uploads.",this._progressArea.insertBefore(e,this._progressArea.children[1]||null)}}_removeInitialPlaceholder(){const e=this.shadowRoot.getElementById("initial-placeholder");e&&(console.log("[UI] Removing initial placeholder"),e.remove())}_formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB","TB"],o=Math.max(0,Math.floor(Math.log(e)/Math.log(t)));return o>=r.length?`${(e/Math.pow(t,r.length-1)).toFixed(2)} ${r[r.length-1]}`:parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+r[o]}_escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}window.customElements.get("multi-file-upload")?console.warn('Custom element "multi-file-upload" already defined.'):window.customElements.define("multi-file-upload",nt)}();
